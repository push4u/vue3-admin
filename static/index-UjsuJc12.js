import{B as se,e as de,E as M,C as pe}from"./element-V6-G1TdP.js";import{u as re}from"./usePagination-rdI7J7GV.js";import{j as P,k as ue,l as me,m as ce,n as _e,o as fe,L as ve,_ as be}from"./index-7zCsDVEK.js";import{l as ge,r as b,Z as $,b as he,ag as s,aq as G,m as _,p as N,V as C,M as g,O as t,u as d,S as c,q as f,I as we,R as x,T as l,F as Ve,P as ye,a7 as ke}from"./vue-ZDMaqQfr.js";import"./vxe-SD4sv8pp.js";const Ce={class:"app-container"},xe={class:"toolbar-wrapper"},ze={class:"table-wrapper"},Pe={class:"pager-wrapper"},Ue={style:{padding:"15px"}},Se={style:{"margin-left":"5px"}},Te={class:"demo-drawer__footer el-table__fixed-footer-wrapper",style:{padding:"10px",display:"block"}},De=ge({name:"menus",__name:"index",setup(Ee){const U=b(!1),{paginationData:u,handleCurrentChange:R,handleSizeChange:q}=re(),h=b(!1),v=b(0),W=b(!1);let S="新增菜单";const T=b(null),n=$({name:"",path:"",hidden:!1,parent_id:0,component:"",meta:{title:"",icon:"",keep_alive:!1,layout:"",api_id:0,default_menu:!1,close_tab:!1,new_window_open:!1},sort:0,parameters:[]}),Z=$({}),H=Object.keys(de),J=i=>{F(),i()},F=()=>{var i;W.value=!1,(i=T.value)==null||i.resetFields()},L=()=>{w.splice(0,w.length,{id:0,title:"根目录"})},A=i=>{L(),h.value=!0,S="新增菜单",n.parent_id=i,v.value=0,D(V.value,w,!1)},w=$([{id:0,title:"根目录"}]),D=(i,a,p)=>{i&&i.map(o=>{if(o.children&&o.children.length){const m={title:o.meta.title,id:o.id,disabled:p||o.id===v.value,children:[]};D(o.children,m.children,p||m.id===v.value),a.push(m)}else{const m={title:o.meta.title,id:o.id,disabled:p||o.id===v.value};a.push(m)}})},K=()=>{var i;(i=T.value)==null||i.validate(async(a,p)=>{if(a){let o;v.value>0?o=await ue(v.value,n):o=await me(n),o.code===0&&(M({type:"success",message:v.value>0?"编辑成功":"添加成功!"}),E()),F(),h.value=!1}else console.error("表单校验不通过",p)})},Q=i=>{pe.confirm("确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await ce({id:[i]})).code===0&&(M.success("删除成功"),E())}).catch(()=>{M.info("已取消删除")})},X=async i=>{L(),h.value=!0,S="编辑菜单";const a=await _e(i.id);Object.assign(n,a.data||{}),v.value=i.id,D(V.value,w,!1)},V=b([]),E=()=>{U.value=!0,fe({page:u.currentPage,page_size:u.pageSize}).then(i=>{u.total=i.data.total,V.value=i.data.list}).catch(()=>{V.value=[]}).finally(()=>{U.value=!1})},Y={emitPath:!1,label:"description",value:"id"},O=b([]);return(()=>{ve({page:1,page_size:999}).then(i=>{let a=[];a=i.data.list,[...new Set(a.map(o=>o.api_group))].forEach(o=>{O.value.push({description:o,id:o,children:[]})}),a.forEach(o=>{O.value.forEach(m=>{m.description===o.api_group&&m.children.push(o)})})})})(),he([()=>u.currentPage,()=>u.pageSize],E,{immediate:!0}),(i,a)=>{const p=s("el-button"),o=s("el-table-column"),m=s("el-table"),ee=s("el-pagination"),le=s("el-card"),y=s("el-input"),r=s("el-form-item"),k=s("el-option"),B=s("el-select"),I=s("el-cascader"),ae=s("el-icon"),te=s("el-input-number"),oe=s("el-form"),ne=s("el-drawer"),z=G("permission"),ie=G("loading");return _(),N("div",Ce,[C((_(),g(le,{shadow:"never"},{default:t(()=>[f("div",xe,[f("div",null,[C((_(),g(p,{type:"primary",icon:d(se),onClick:a[0]||(a[0]=e=>A(0))},{default:t(()=>[c("新增菜单")]),_:1},8,["icon"])),[[z,d(P)+"_POST"]])])]),f("div",ze,[l(m,{data:V.value,"row-key":"id"},{default:t(()=>[l(o,{prop:"title",label:"菜单","min-width":"150"},{default:t(e=>[f("span",null,[f("i",{class:we(`${e.row.meta.icon}`)},null,2),c(" "+x(e.row.meta.title),1)])]),_:1}),l(o,{prop:"path",label:"路由","min-width":"110"}),l(o,{prop:"layout",label:"布局","min-width":"110"},{default:t(e=>[c(x(e.row.meta.layout),1)]),_:1}),l(o,{prop:"newWindowOpen",label:"新窗口打开","min-width":"110"},{default:t(e=>[c(x(e.row.meta.newWindowOpen?"是":"否"),1)]),_:1}),l(o,{prop:"hidden",label:"是否显示","min-width":"110"},{default:t(e=>[c(x(e.row.hidden?"隐藏":"显示"),1)]),_:1}),l(o,{prop:"sort",label:"排序","min-width":"70"}),l(o,{prop:"component",label:"文件路径","min-width":"160"}),l(o,{label:"操作",width:"200",align:"center"},{default:t(e=>[C((_(),g(p,{onClick:j=>A(e.row.id),type:"primary",text:"",bg:"",size:"small"},{default:t(()=>[c("子菜单")]),_:2},1032,["onClick"])),[[z,d(P)+"_POST"]]),C((_(),g(p,{onClick:j=>X(e.row),type:"primary",text:"",bg:"",size:"small"},{default:t(()=>[c("编辑")]),_:2},1032,["onClick"])),[[z,d(P)+"/:id_PUT"]]),C((_(),g(p,{onClick:j=>Q(e.row.id),type:"danger",text:"",bg:"",size:"small"},{default:t(()=>[c("删除")]),_:2},1032,["onClick"])),[[z,d(P)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),f("div",Pe,[l(ee,{background:"",layout:d(u).layout,"page-sizes":d(u).pageSizes,total:d(u).total,"page-size":d(u).pageSize,currentPage:d(u).currentPage,onSizeChange:d(q),onCurrentChange:d(R)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[ie,U.value]]),l(ne,{modelValue:h.value,"onUpdate:modelValue":a[13]||(a[13]=e=>h.value=e),"before-close":J,size:"600px",title:d(S)},{default:t(()=>[f("div",Ue,[l(oe,{ref_key:"formRef",ref:T,model:n,rules:Z,"label-width":"100px"},{default:t(()=>[l(r,{label:"路由name",prop:"name"},{default:t(()=>[l(y,{modelValue:n.name,"onUpdate:modelValue":a[1]||(a[1]=e=>n.name=e),autocomplete:"off",placeholder:"唯一英文字符串"},null,8,["modelValue"])]),_:1}),l(r,{prop:"path",label:"路由path"},{default:t(()=>[l(y,{modelValue:n.path,"onUpdate:modelValue":a[2]||(a[2]=e=>n.path=e),autocomplete:"off",placeholder:"建议只在后方拼接参数"},null,8,["modelValue"])]),_:1}),l(r,{prop:"hidden",label:"是否隐藏"},{default:t(()=>[l(B,{modelValue:n.hidden,"onUpdate:modelValue":a[3]||(a[3]=e=>n.hidden=e),placeholder:"是否在列表隐藏"},{default:t(()=>[l(k,{value:!1,label:"否"}),l(k,{value:!0,label:"是"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"父级菜单"},{default:t(()=>[l(I,{modelValue:n.parent_id,"onUpdate:modelValue":a[4]||(a[4]=e=>n.parent_id=e),options:w,props:{checkStrictly:!0,label:"title",value:"id",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","options"])]),_:1}),l(r,{label:"文件路径",prop:"component"},{default:t(()=>[l(y,{modelValue:n.component,"onUpdate:modelValue":a[5]||(a[5]=e=>n.component=e)},null,8,["modelValue"]),l(p,{onClick:a[6]||(a[6]=e=>n.component="layouts/index.vue")},{default:t(()=>[c("是父级菜单")]),_:1})]),_:1}),l(r,{label:"展示名称",prop:"title"},{default:t(()=>[l(y,{modelValue:n.meta.title,"onUpdate:modelValue":a[7]||(a[7]=e=>n.meta.title=e)},null,8,["modelValue"])]),_:1}),l(r,{label:"图标",prop:"icon"},{default:t(()=>[l(B,{class:"gva-select",style:{width:"100%"},modelValue:n.meta.icon,"onUpdate:modelValue":a[8]||(a[8]=e=>n.meta.icon=e),placeholder:"请选择"},{default:t(()=>[(_(!0),N(Ve,null,ke(d(H),e=>(_(),g(k,{key:e,label:e,value:e},{default:t(()=>[l(ae,{size:20,style:{"vertical-align":"middle"}},{default:t(()=>[(_(),g(ye(e)))]),_:2},1024),f("span",Se,x(e),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{prop:"sort",label:"排序"},{default:t(()=>[l(te,{modelValue:n.sort,"onUpdate:modelValue":a[9]||(a[9]=e=>n.sort=e),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(r,{label:"keepAlive",prop:"meta.keepAlive"},{default:t(()=>[l(B,{modelValue:n.meta.keep_alive,"onUpdate:modelValue":a[10]||(a[10]=e=>n.meta.keep_alive=e)},{default:t(()=>[l(k,{value:!1,label:"否"}),l(k,{value:!0,label:"是"})]),_:1},8,["modelValue"])]),_:1}),l(r,{prop:"layout",label:"布局"},{default:t(()=>[l(y,{modelValue:n.meta.layout,"onUpdate:modelValue":a[11]||(a[11]=e=>n.meta.layout=e),autocomplete:"off",placeholder:"布局"},null,8,["modelValue"])]),_:1}),l(r,{prop:"api_id",label:"Api"},{default:t(()=>[l(I,{modelValue:n.meta.api_id,"onUpdate:modelValue":a[12]||(a[12]=e=>n.meta.api_id=e),options:O.value,props:Y,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"]),f("div",Te,[l(p,{type:"primary",onClick:K},{default:t(()=>[c("保存")]),_:1})])])]),_:1},8,["modelValue","title"])])}}}),Ae=be(De,[["__scopeId","data-v-2358eb66"]]);export{Ae as default};
