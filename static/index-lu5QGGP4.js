import{A as ne,r as ue,B as ie,G as de,E as y,C as pe}from"./element-V6-G1TdP.js";import{u as ce}from"./usePagination-rdI7J7GV.js";import{i as me,_ as ge}from"./index-12UhzDxg.js";import{a as E,C as fe,U as _e,D as ve,G as he,L as be}from"./index-djxoJN9_.js";import{S as we}from"./index-z--dZugw.js";import{S as Ve}from"./index-9ThuAC7A.js";import{a as ye}from"./index-SX4LvUSN.js";import{l as ke,r as g,Z as R,b as Ce,ag as c,aq as N,m as f,p as A,V as k,M as b,O as a,T as e,u as n,S as w,q as C,R as Se,Q as Ue}from"./vue-ZDMaqQfr.js";import"./vxe-SD4sv8pp.js";const De={class:"app-container"},Pe={class:"toolbar-wrapper"},qe={class:"table-wrapper"},xe={class:"pager-wrapper"},ze=["src"],Be=ke({name:"user",__name:"index",setup(Ee){const S=g(!1),{paginationData:i,handleCurrentChange:F,handleSizeChange:j}=ce(),h=g(!1),q=g(null),r=g({}),I=R({username:[{required:!0,trigger:"blur",message:"请输入用户名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"}],confirm_password:[{required:!0,trigger:"blur",message:"请确认密码"}],nickname:[{required:!0,trigger:"blur",message:"请输入姓名"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"}],group_id:[{required:!0,trigger:"change",message:"请选择部门"}],roles:[{required:!0,trigger:"change",message:"请选择角色"}]}),L=R({username:[{required:!0,trigger:"blur",message:"请输入用户名"}],nickname:[{required:!0,trigger:"blur",message:"请输入姓名"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"}],group_id:[{required:!0,trigger:"change",message:"请选择部门"}],roles:[{required:!0,trigger:"change",message:"请选择角色"}]}),O=me(),J="https://demo.push4u.com",Q=t=>{r.value.avatar=t.data.id,r.value.avatar_file=t.data},Z=t=>t.type!=="image/jpeg"&&t.type!=="image/jpg"&&t.type!=="image/png"?(y.error("头像图片只能是 JPG 或 PNG 格式!"),!1):t.size/1024/1024>2?(y.error("头像图片大小不能超过 2MB!"),!1):!0,H=()=>{var t;(t=q.value)==null||t.validate((l,d)=>{l?_.value===void 0?fe(r.value).then(()=>{y.success("新增成功"),V()}).finally(()=>{h.value=!1}):_e(_.value,{...r.value}).then(()=>{y.success("修改成功"),V()}).finally(()=>{h.value=!1}):console.error("表单校验不通过",d)})},K=()=>{var t;_.value=void 0,(t=q.value)==null||t.resetFields(),r.value={}},W=t=>{pe.confirm("确定要删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ve({id:[t.id]}).then(()=>{y.success("删除成功"),V()})})},_=g(void 0),X=t=>{he(t.id).then(l=>{var s,u;_.value=l.data.id,Object.assign(r.value,l.data||{});const d=l.data;if((((s=d.roles)==null?void 0:s.length)??0)>0){const p=[];(u=d.roles)==null||u.forEach(P=>{p.push(P.id)}),r.value.roles=p}h.value=!0})},U=g([]),T=g(null),m=R({group_id:0,role_id:0,keyword:""}),V=()=>{S.value=!0,be({page:i.currentPage,page_size:i.pageSize,group_id:m.group_id,role_id:m.role_id,keyword:m.keyword}).then(t=>{i.total=t.data.total,U.value=t.data.list,U.value.forEach(l=>{var d,s;if((((d=l.roles)==null?void 0:d.length)??0)>0){let u="";(s=l.roles)==null||s.forEach(p=>{u=u+p.name+","}),l.roleDataForDisplay=u.slice(0,-1)}})}).catch(()=>{U.value=[]}).finally(()=>{S.value=!1})},G=()=>{i.currentPage===1?V():i.currentPage=1},Y=()=>{var t;(t=T.value)==null||t.resetFields(),G()},D={checkStrictly:!0,emitPath:!1},ee={...D,multiple:!0},x=g([]);(()=>{we().then(t=>{x.value=t.data})})();const z=g([]);return(()=>{Ve().then(t=>{z.value=t.data})})(),Ce([()=>i.currentPage,()=>i.pageSize],V,{immediate:!0}),(t,l)=>{const d=c("el-cascader"),s=c("el-form-item"),u=c("el-input"),p=c("el-button"),P=c("el-form"),$=c("el-card"),v=c("el-table-column"),le=c("el-table"),ae=c("el-pagination"),oe=c("el-icon"),te=c("el-upload"),re=c("el-dialog"),M=N("loading"),B=N("permission");return f(),A("div",De,[k((f(),b($,{shadow:"never",class:"search-wrapper"},{default:a(()=>[e(P,{ref_key:"searchFormRef",ref:T,inline:!0,model:m},{default:a(()=>[e(s,{prop:"group_id",label:"部门"},{default:a(()=>[e(d,{modelValue:m.group_id,"onUpdate:modelValue":l[0]||(l[0]=o=>m.group_id=o),options:z.value,props:D,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),e(s,{prop:"role",label:"角色"},{default:a(()=>[e(d,{modelValue:m.role_id,"onUpdate:modelValue":l[1]||(l[1]=o=>m.role_id=o),options:x.value,props:D,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),e(s,{prop:"keyword",label:"关键字"},{default:a(()=>[e(u,{modelValue:m.keyword,"onUpdate:modelValue":l[2]||(l[2]=o=>m.keyword=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(p,{type:"primary",icon:n(ne),onClick:G},{default:a(()=>[w("查询")]),_:1},8,["icon"]),e(p,{icon:n(ue),onClick:Y},{default:a(()=>[w("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1})),[[M,S.value]]),k((f(),b($,{shadow:"never"},{default:a(()=>[C("div",Pe,[C("div",null,[k((f(),b(p,{type:"primary",icon:n(ie),onClick:l[3]||(l[3]=o=>h.value=!0)},{default:a(()=>[w("新增用户")]),_:1},8,["icon"])),[[B,n(E)+"_POST"]])])]),C("div",qe,[e(le,{data:U.value},{default:a(()=>[e(v,{prop:"id",label:"ID","min-width":"110"}),e(v,{prop:"username",label:"用户名","min-width":"110"}),e(v,{prop:"nickname",label:"姓名","min-width":"160",sortable:""}),e(v,{prop:"phone",label:"手机号","min-width":"110"}),e(v,{prop:"email",label:"邮箱","min-width":"110"}),e(v,{prop:"group",label:"部门","min-width":"110"},{default:a(o=>[C("span",null,Se(o.row.group.name),1)]),_:1}),e(v,{prop:"roleDataForDisplay",label:"角色","min-width":"110"}),e(v,{label:"操作",width:"150",align:"center"},{default:a(o=>[k((f(),b(p,{type:"primary",text:"",bg:"",size:"small",onClick:se=>X(o.row)},{default:a(()=>[w("修改")]),_:2},1032,["onClick"])),[[B,n(E)+"/:id_PUT"]]),k((f(),b(p,{type:"danger",text:"",bg:"",size:"small",disabled:o.row.id==1,onClick:se=>W(o.row)},{default:a(()=>[w("删除")]),_:2},1032,["disabled","onClick"])),[[B,n(E)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),C("div",xe,[e(ae,{background:"",layout:n(i).layout,"page-sizes":n(i).pageSizes,total:n(i).total,"page-size":n(i).pageSize,currentPage:n(i).currentPage,onSizeChange:n(j),onCurrentChange:n(F)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[M,S.value]]),e(re,{modelValue:h.value,"onUpdate:modelValue":l[12]||(l[12]=o=>h.value=o),title:_.value===void 0?"新增":"修改",onClose:K,width:"30%"},{footer:a(()=>[e(p,{onClick:l[11]||(l[11]=o=>h.value=!1)},{default:a(()=>[w("取消")]),_:1}),e(p,{type:"primary",onClick:H},{default:a(()=>[w("确认")]),_:1})]),default:a(()=>[e(P,{ref_key:"formRef",ref:q,model:r.value,rules:_.value===void 0?I:L,"validate-on-rule-change":!1,"label-width":"100px","label-position":"right"},{default:a(()=>[e(s,{prop:"password",label:"密码"},{default:a(()=>[e(u,{modelValue:r.value.password,"onUpdate:modelValue":l[4]||(l[4]=o=>r.value.password=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),_.value===void 0?(f(),b(s,{key:0,prop:"confirm_password",label:"确认密码"},{default:a(()=>[e(u,{modelValue:r.value.confirm_password,"onUpdate:modelValue":l[5]||(l[5]=o=>r.value.confirm_password=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1})):Ue("",!0),e(s,{prop:"nickname",label:"姓名"},{default:a(()=>[e(u,{modelValue:r.value.nickname,"onUpdate:modelValue":l[6]||(l[6]=o=>r.value.nickname=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"phone",label:"手机号"},{default:a(()=>[e(u,{modelValue:r.value.phone,"onUpdate:modelValue":l[7]||(l[7]=o=>r.value.phone=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"email",label:"邮箱"},{default:a(()=>[e(u,{modelValue:r.value.email,"onUpdate:modelValue":l[8]||(l[8]=o=>r.value.email=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"group_id",label:"部门"},{default:a(()=>[e(d,{modelValue:r.value.group_id,"onUpdate:modelValue":l[9]||(l[9]=o=>r.value.group_id=o),options:z.value,props:D,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),e(s,{prop:"roles",label:"角色"},{default:a(()=>[e(d,{modelValue:r.value.roles,"onUpdate:modelValue":l[10]||(l[10]=o=>r.value.roles=o),options:x.value,props:ee,disabled:_.value==1,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options","disabled"])]),_:1}),e(s,{label:"头像","label-width":"80px"},{default:a(()=>[e(te,{class:"avatar-uploader",action:`${n(J)+ye}`,"show-file-list":!1,headers:{Authorization:"Bearer "+n(O)},"on-success":Q,"before-upload":Z},{default:a(()=>[r.value.avatar_file&&r.value.avatar_file.url.length>0?(f(),A("img",{key:0,src:r.value.avatar_file&&r.value.avatar_file.url,class:"avatar"},null,8,ze)):(f(),b(oe,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[e(n(de))]),_:1}))]),_:1},8,["action","headers"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Oe=ge(Be,[["__scopeId","data-v-bf5d8cbe"]]);export{Oe as default};
