import{A as ne,r as ue,B as ie,G as de,E as y,C as pe}from"./element-V6-G1TdP.js";import{u as me}from"./usePagination-rdI7J7GV.js";import{i as ce,_ as ge}from"./index-V2DfqRNy.js";import{a as E,C as fe,U as _e,D as ve,G as he,L as be}from"./index-deENr3Es.js";import{S as Ve}from"./index-UBLY8o4l.js";import{S as we}from"./index-KQ1T6CW-.js";import{a as ye}from"./index-fS4YW--K.js";import{l as ke,r as g,Z as R,b as Ce,ag as m,aq as N,m as f,p as A,V as k,M as b,O as o,T as e,u as n,S as V,q as C,R as Se,Q as Ue}from"./vue-ZDMaqQfr.js";import"./vxe-SD4sv8pp.js";const De={class:"app-container"},Pe={class:"toolbar-wrapper"},qe={class:"table-wrapper"},xe={class:"pager-wrapper"},ze=["src"],Be=ke({name:"user",__name:"index",setup(Ee){const S=g(!1),{paginationData:i,handleCurrentChange:F,handleSizeChange:j}=me(),h=g(!1),q=g(null),t=g({}),I=R({username:[{required:!0,trigger:"blur",message:"请输入用户名"}],password:[{required:!0,trigger:"blur",message:"请输入密码"}],confirm_password:[{required:!0,trigger:"blur",message:"请确认密码"}],nickname:[{required:!0,trigger:"blur",message:"请输入姓名"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"}],group_id:[{required:!0,trigger:"change",message:"请选择部门"}],roles:[{required:!0,trigger:"change",message:"请选择角色"}]}),L=R({username:[{required:!0,trigger:"blur",message:"请输入用户名"}],nickname:[{required:!0,trigger:"blur",message:"请输入姓名"}],phone:[{required:!0,trigger:"blur",message:"请输入手机号"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"}],group_id:[{required:!0,trigger:"change",message:"请选择部门"}],roles:[{required:!0,trigger:"change",message:"请选择角色"}]}),O=ce(),J="https://demo.push4u.com",Q=r=>{t.value.avatar=r.data.id,t.value.avatar_file=r.data},Z=r=>r.type!=="image/jpeg"&&r.type!=="image/jpg"&&r.type!=="image/png"?(y.error("头像图片只能是 JPG 或 PNG 格式!"),!1):r.size/1024/1024>2?(y.error("头像图片大小不能超过 2MB!"),!1):!0,H=()=>{var r;(r=q.value)==null||r.validate((l,d)=>{l?_.value===void 0?fe(t.value).then(()=>{y.success("新增成功"),w()}).finally(()=>{h.value=!1}):_e(_.value,{...t.value}).then(()=>{y.success("修改成功"),w()}).finally(()=>{h.value=!1}):console.error("表单校验不通过",d)})},K=()=>{var r;_.value=void 0,(r=q.value)==null||r.resetFields(),t.value={}},W=r=>{pe.confirm("确定要删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ve({id:[r.id]}).then(()=>{y.success("删除成功"),w()})})},_=g(void 0),X=r=>{he(r.id).then(l=>{var s,u;_.value=l.data.id,Object.assign(t.value,l.data||{});const d=l.data;if((((s=d.roles)==null?void 0:s.length)??0)>0){const p=[];(u=d.roles)==null||u.forEach(P=>{p.push(P.id)}),t.value.roles=p}h.value=!0})},U=g([]),T=g(null),c=R({group_id:0,role_id:0,keyword:""}),w=()=>{S.value=!0,be({page:i.currentPage,page_size:i.pageSize,group_id:c.group_id,role_id:c.role_id,keyword:c.keyword}).then(r=>{i.total=r.data.total,U.value=r.data.list,U.value.forEach(l=>{var d,s;if((((d=l.roles)==null?void 0:d.length)??0)>0){let u="";(s=l.roles)==null||s.forEach(p=>{u=u+p.name+","}),l.roleDataForDisplay=u.slice(0,-1)}})}).catch(()=>{U.value=[]}).finally(()=>{S.value=!1})},G=()=>{i.currentPage===1?w():i.currentPage=1},Y=()=>{var r;(r=T.value)==null||r.resetFields(),G()},D={checkStrictly:!0,emitPath:!1},ee={...D,multiple:!0},x=g([]);(()=>{Ve().then(r=>{x.value=r.data})})();const z=g([]);return(()=>{we().then(r=>{z.value=r.data})})(),Ce([()=>i.currentPage,()=>i.pageSize],w,{immediate:!0}),(r,l)=>{const d=m("el-cascader"),s=m("el-form-item"),u=m("el-input"),p=m("el-button"),P=m("el-form"),$=m("el-card"),v=m("el-table-column"),le=m("el-table"),ae=m("el-pagination"),oe=m("el-icon"),te=m("el-upload"),re=m("el-dialog"),M=N("loading"),B=N("permission");return f(),A("div",De,[k((f(),b($,{shadow:"never",class:"search-wrapper"},{default:o(()=>[e(P,{ref_key:"searchFormRef",ref:T,inline:!0,model:c},{default:o(()=>[e(s,{prop:"group_id",label:"部门"},{default:o(()=>[e(d,{modelValue:c.group_id,"onUpdate:modelValue":l[0]||(l[0]=a=>c.group_id=a),options:z.value,props:D,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),e(s,{prop:"role",label:"角色"},{default:o(()=>[e(d,{modelValue:c.role_id,"onUpdate:modelValue":l[1]||(l[1]=a=>c.role_id=a),options:x.value,props:D,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),e(s,{prop:"keyword",label:"关键字"},{default:o(()=>[e(u,{modelValue:c.keyword,"onUpdate:modelValue":l[2]||(l[2]=a=>c.keyword=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,null,{default:o(()=>[e(p,{type:"primary",icon:n(ne),onClick:G},{default:o(()=>[V("查询")]),_:1},8,["icon"]),e(p,{icon:n(ue),onClick:Y},{default:o(()=>[V("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1})),[[M,S.value]]),k((f(),b($,{shadow:"never"},{default:o(()=>[C("div",Pe,[C("div",null,[k((f(),b(p,{type:"primary",icon:n(ie),onClick:l[3]||(l[3]=a=>h.value=!0)},{default:o(()=>[V("新增用户")]),_:1},8,["icon"])),[[B,n(E)+"_POST"]])])]),C("div",qe,[e(le,{data:U.value},{default:o(()=>[e(v,{prop:"id",label:"ID","min-width":"110"}),e(v,{prop:"username",label:"用户名","min-width":"110"}),e(v,{prop:"nickname",label:"姓名","min-width":"160",sortable:""}),e(v,{prop:"phone",label:"手机号","min-width":"110"}),e(v,{prop:"email",label:"邮箱","min-width":"110"}),e(v,{prop:"group",label:"部门","min-width":"110"},{default:o(a=>[C("span",null,Se(a.row.group.name),1)]),_:1}),e(v,{prop:"roleDataForDisplay",label:"角色","min-width":"110"}),e(v,{label:"操作",width:"150",align:"center"},{default:o(a=>[k((f(),b(p,{type:"primary",text:"",bg:"",size:"small",onClick:se=>X(a.row)},{default:o(()=>[V("修改")]),_:2},1032,["onClick"])),[[B,n(E)+"/:id_PUT"]]),k((f(),b(p,{type:"danger",text:"",bg:"",size:"small",disabled:a.row.id==1,onClick:se=>W(a.row)},{default:o(()=>[V("删除")]),_:2},1032,["disabled","onClick"])),[[B,n(E)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),C("div",xe,[e(ae,{background:"",layout:n(i).layout,"page-sizes":n(i).pageSizes,total:n(i).total,"page-size":n(i).pageSize,currentPage:n(i).currentPage,onSizeChange:n(j),onCurrentChange:n(F)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[M,S.value]]),e(re,{modelValue:h.value,"onUpdate:modelValue":l[13]||(l[13]=a=>h.value=a),title:_.value===void 0?"新增":"修改",onClose:K,width:"30%"},{footer:o(()=>[e(p,{onClick:l[12]||(l[12]=a=>h.value=!1)},{default:o(()=>[V("取消")]),_:1}),e(p,{type:"primary",onClick:H},{default:o(()=>[V("确认")]),_:1})]),default:o(()=>[e(P,{ref_key:"formRef",ref:q,model:t.value,rules:_.value===void 0?I:L,"validate-on-rule-change":!1,"label-width":"100px","label-position":"right"},{default:o(()=>[e(s,{prop:"username",label:"用户名"},{default:o(()=>[e(u,{modelValue:t.value.username,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.username=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"password",label:"密码"},{default:o(()=>[e(u,{modelValue:t.value.password,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.password=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),_.value===void 0?(f(),b(s,{key:0,prop:"confirm_password",label:"确认密码"},{default:o(()=>[e(u,{modelValue:t.value.confirm_password,"onUpdate:modelValue":l[6]||(l[6]=a=>t.value.confirm_password=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1})):Ue("",!0),e(s,{prop:"nickname",label:"姓名"},{default:o(()=>[e(u,{modelValue:t.value.nickname,"onUpdate:modelValue":l[7]||(l[7]=a=>t.value.nickname=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"phone",label:"手机号"},{default:o(()=>[e(u,{modelValue:t.value.phone,"onUpdate:modelValue":l[8]||(l[8]=a=>t.value.phone=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"email",label:"邮箱"},{default:o(()=>[e(u,{modelValue:t.value.email,"onUpdate:modelValue":l[9]||(l[9]=a=>t.value.email=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(s,{prop:"group_id",label:"部门"},{default:o(()=>[e(d,{modelValue:t.value.group_id,"onUpdate:modelValue":l[10]||(l[10]=a=>t.value.group_id=a),options:z.value,props:D,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),e(s,{prop:"roles",label:"角色"},{default:o(()=>[e(d,{modelValue:t.value.roles,"onUpdate:modelValue":l[11]||(l[11]=a=>t.value.roles=a),options:x.value,props:ee,disabled:_.value==1,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options","disabled"])]),_:1}),e(s,{label:"头像","label-width":"80px"},{default:o(()=>[e(te,{class:"avatar-uploader",action:`${n(J)+ye}`,"show-file-list":!1,headers:{Authorization:"Bearer "+n(O)},"on-success":Q,"before-upload":Z},{default:o(()=>[t.value.avatar_file&&t.value.avatar_file.url.length>0?(f(),A("img",{key:0,src:t.value.avatar_file&&t.value.avatar_file.url,class:"avatar"},null,8,ze)):(f(),b(oe,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[e(n(de))]),_:1}))]),_:1},8,["action","headers"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Oe=ge(Be,[["__scopeId","data-v-88b0383d"]]);export{Oe as default};
