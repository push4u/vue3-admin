import{B as Y,E as k,C as ee}from"./element-V6-G1TdP.js";import{u as ae}from"./usePagination-rdI7J7GV.js";import{f as te}from"./index-q1rzTrQ-.js";import{a as w,C as le,U as oe,D as ne,G as re,L as se,S as ie}from"./index-GcAM2lvu.js";import{L as ue}from"./index-GbJG_hHR.js";import{l as de,r as c,Z as pe,b as ce,e as me,ag as s,aq as B,m as f,p as _e,V as v,M as g,O as t,u as i,S as u,q as y,T as l,R as P}from"./vue-ZDMaqQfr.js";import{_ as fe}from"./index-nlWAN4x3.js";import"./vxe-SD4sv8pp.js";const ve={class:"app-container"},ge={class:"toolbar-wrapper"},be={class:"table-wrapper"},he={class:"pager-wrapper"},Ce=de({name:"group",__name:"index",setup(we){const V=c(!1),{paginationData:d,handleCurrentChange:L,handleSizeChange:q}=ae(),p=c(!1),z=c(null),n=c({}),$=pe({name:[{required:!0,trigger:"blur",message:"请输入名称"}],sort:[{required:!0,trigger:"blur",message:"请输入排序"}],status:[{required:!0,trigger:"change",message:"请选择启用状态"}],parent_id:[{required:!0,validator:(a,e,r)=>{e==null||e===""?r(new Error("请选择上级部门")):e===m.value?r(new Error("不能选择本部门为上级部门")):r()},trigger:"change"}]}),O=()=>{var a;(a=z.value)==null||a.validate((e,r)=>{e?m.value===void 0?le(n.value).then(()=>{k.success("新增成功"),b()}).finally(()=>{p.value=!1}):oe(m.value,{...n.value}).then(()=>{k.success("修改成功"),b()}).finally(()=>{p.value=!1}):console.error("表单校验不通过",r)})},I=a=>{n.value.parent_id=a.id,p.value=!0},M=()=>{var a;m.value=void 0,(a=z.value)==null||a.resetFields(),n.value={}},R=a=>{ee.confirm("确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ne({id:[a.id]}).then(()=>{k.success("删除成功"),b()})})},m=c(void 0),G=a=>{re(a.id).then(e=>{m.value=e.data.id,Object.assign(n.value,e.data||{}),p.value=!0})},S=c([]),b=()=>{V.value=!0,se({page:d.currentPage,page_size:d.pageSize}).then(a=>{d.total=a.data.total,S.value=a.data.list,j()}).catch(()=>{S.value=[]}).finally(()=>{V.value=!1})},N=c([]);(()=>{ue({page:1,page_size:999}).then(a=>{N.value=a.data.list})})();const F={emitPath:!1,checkStrictly:!0},x=c([]),j=()=>{ie().then(a=>{x.value=a.data,x.value.unshift({value:0,label:"顶级部门"})})};ce([()=>d.currentPage,()=>d.pageSize],b,{immediate:!0});const D=me(()=>a=>te(a));return(a,e)=>{const r=s("el-button"),_=s("el-table-column"),H=s("el-table"),Z=s("el-pagination"),A=s("el-card"),U=s("el-input"),h=s("el-form-item"),J=s("el-cascader"),T=s("el-radio"),K=s("el-radio-group"),Q=s("el-form"),W=s("el-dialog"),C=B("permission"),X=B("loading");return f(),_e("div",ve,[v((f(),g(A,{shadow:"never"},{default:t(()=>[y("div",ge,[y("div",null,[v((f(),g(r,{type:"primary",icon:i(Y),onClick:e[0]||(e[0]=o=>p.value=!0)},{default:t(()=>[u("新增部门")]),_:1},8,["icon"])),[[C,i(w)+"_POST"]])])]),y("div",be,[l(H,{data:S.value,"row-key":"id"},{default:t(()=>[l(_,{prop:"name",label:"部门名称","min-width":"130"}),l(_,{prop:"sort",label:"排序","min-width":"110"}),l(_,{prop:"status",label:"启用","min-width":"110"},{default:t(o=>[u(P(o.row.status?"是":"否"),1)]),_:1}),l(_,{prop:"created_at",label:"创建时间","min-width":"160",sortable:""},{default:t(o=>[u(P(D.value(o.row.created_at)),1)]),_:1}),l(_,{prop:"updated_at",label:"最后更新时间","min-width":"160",sortable:""},{default:t(o=>[u(P(D.value(o.row.updated_at)),1)]),_:1}),l(_,{label:"操作",width:"200",align:"center"},{default:t(o=>[v((f(),g(r,{type:"primary",text:"",bg:"",size:"small",onClick:E=>I(o.row)},{default:t(()=>[u("子部门")]),_:2},1032,["onClick"])),[[C,i(w)+"_POST"]]),v((f(),g(r,{type:"primary",text:"",bg:"",size:"small",onClick:E=>G(o.row)},{default:t(()=>[u("修改")]),_:2},1032,["onClick"])),[[C,i(w)+"/:id_PUT"]]),v((f(),g(r,{type:"danger",text:"",bg:"",size:"small",onClick:E=>R(o.row)},{default:t(()=>[u("删除")]),_:2},1032,["onClick"])),[[C,i(w)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),y("div",he,[l(Z,{background:"",layout:i(d).layout,"page-sizes":i(d).pageSizes,total:i(d).total,"page-size":i(d).pageSize,currentPage:i(d).currentPage,onSizeChange:i(q),onCurrentChange:i(L)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[X,V.value]]),l(W,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value=o),title:m.value===void 0?"新增":"修改",onClose:M,width:"30%"},{footer:t(()=>[l(r,{onClick:e[5]||(e[5]=o=>p.value=!1)},{default:t(()=>[u("取消")]),_:1}),l(r,{type:"primary",onClick:O},{default:t(()=>[u("确认")]),_:1})]),default:t(()=>[l(Q,{ref_key:"formRef",ref:z,model:n.value,rules:$,"label-width":"100px","label-position":"right"},{default:t(()=>[l(h,{prop:"name",label:"部门名称"},{default:t(()=>[l(U,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.name=o),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(h,{prop:"parent_id",label:"上级部门"},{default:t(()=>[l(J,{modelValue:n.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.parent_id=o),options:x.value,props:F,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),l(h,{prop:"sort",label:"排序"},{default:t(()=>[l(U,{modelValue:n.value.sort,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.sort=o),modelModifiers:{number:!0},placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(h,{prop:"status",label:"是否启用"},{default:t(()=>[l(K,{modelValue:n.value.status,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.status=o)},{default:t(()=>[l(T,{label:1},{default:t(()=>[u("是")]),_:1}),l(T,{label:0},{default:t(()=>[u("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Ee=fe(Ce,[["__scopeId","data-v-2041540f"]]);export{Ee as default};
