import{j as G,t as L,p as S,v as $}from"./index-CwLK-C8Q.js";import{a as O}from"./index-EViHp-XO.js";import{E as i}from"./element-V6-G1TdP.js";import{l as R,r as d,ag as r,m as f,p as b,T as t,O as o,u as V,M as D,S as k}from"./vue-ZDMaqQfr.js";const J=["src"],X=R({name:"mySetting",__name:"setting",setup(H){const a=d({}),y={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],avatar:[{required:!0,message:"请选择头像",trigger:" blur"}]},m=d(null),c=d(),x=G(),C="https://demo.push4u.com";L().then(e=>{if(Object.assign(a.value,e.data||{}),e.data.option){const l=e.data.option.default_router.split("/").filter(Boolean);c.value=l.map((u,p)=>p===0?`/${u}`:u)}});const M={label:"title",value:"path"},U=e=>{a.value.option&&(a.value.option.default_router=e.join("/"))},_=d([]),v=e=>e.map(l=>({title:l.meta.title,path:l.path,children:l.children?v(l.children):[]})),B=()=>{S({page:1,page_size:999}).then(e=>{_.value=v(e.data.list)})},P=e=>e.type!=="image/jpeg"&&e.type!=="image/jpg"&&e.type!=="image/png"?(i.error("头像图片只能是 JPG 或 PNG 格式!"),!1):e.size/1024/1024>2?(i.error("头像图片大小不能超过 2MB!"),!1):!0,j=e=>{a.value.avatar=e.data.id,a.value.avatar_file=e.data},w=e=>{i.error(`头像上传失败: ${e}`)},q=()=>{var e;(e=m.value)==null||e.validate(l=>{if(l)$(a.value).then(u=>{a.value=u.data,i.success("修改成功"),g()});else return!1})},g=()=>{var e;(e=m.value)==null||e.resetFields()};return B(),(e,l)=>{const u=r("el-input"),p=r("el-col"),s=r("el-form-item"),E=r("Plus"),N=r("el-icon"),T=r("el-upload"),z=r("el-cascader"),h=r("el-button"),A=r("el-form");return f(),b("div",null,[t(A,{model:a.value,rules:y,"label-width":"80px",ref_key:"formRef",ref:m},{default:o(()=>[t(s,{label:"姓名","label-width":"80px",prop:"nickName"},{default:o(()=>[t(p,{span:12},{default:o(()=>[t(u,{modelValue:a.value.nickname,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.nickname=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{label:"手机号","label-width":"80px",prop:"phone"},{default:o(()=>[t(p,{span:12},{default:o(()=>[t(u,{modelValue:a.value.phone,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.phone=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{label:"邮箱","label-width":"80px",prop:"email"},{default:o(()=>[t(p,{span:12},{default:o(()=>[t(u,{modelValue:a.value.email,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.email=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(s,{label:"头像","label-width":"80px"},{default:o(()=>[t(T,{class:"avatar-uploader",action:`${V(C)+O}`,headers:{Authorization:"Bearer "+V(x)},"show-file-list":!1,"on-error":w,"on-success":j,"before-upload":P,modelValue:a.value.avatar,"onUpdate:modelValue":l[3]||(l[3]=n=>a.value.avatar=n)},{default:o(()=>[a.value.avatar_file&&a.value.avatar_file.url.length>0?(f(),b("img",{key:0,src:a.value.avatar_file&&a.value.avatar_file.url,class:"avatar"},null,8,J)):(f(),D(N,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[t(E)]),_:1}))]),_:1},8,["action","headers","modelValue"])]),_:1}),t(s,{prop:"default_router",label:"默认首页"},{default:o(()=>[t(z,{modelValue:c.value,"onUpdate:modelValue":l[4]||(l[4]=n=>c.value=n),options:_.value,props:M,placeholder:"默认首页","show-all-levels":!0,onChange:U,clearable:""},null,8,["modelValue","options"])]),_:1}),t(s,null,{default:o(()=>[t(h,{onClick:q,type:"primary"},{default:o(()=>[k("保存")]),_:1}),t(h,{onClick:g},{default:o(()=>[k("重置")]),_:1})]),_:1})]),_:1},8,["model"])])}}});export{X as _};
