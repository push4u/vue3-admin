import{A as te,r as oe,B as re,E as A,C as ie}from"./element-V6-G1TdP.js";import{u as ne}from"./usePagination-rdI7J7GV.js";import{g as de}from"./dict-VYTRGhug.js";import{h as L,C as ue,U as se,D as pe,i as me,L as _e,_ as ge}from"./index-CwLK-C8Q.js";import{l as ce,r as v,Z as O,b as fe,ag as s,aq as I,m,p as q,V as C,M as b,O as a,T as e,F as M,u as d,a7 as N,S as n,q as U,R as B}from"./vue-ZDMaqQfr.js";import"./index-OpaTHyf2.js";import"./index-kbXo1LTr.js";import"./vxe-SD4sv8pp.js";const ve={class:"app-container"},be={class:"toolbar-wrapper"},he={class:"table-wrapper"},Ve={class:"pager-wrapper"},we=ce({name:"api",__name:"index",setup(Ce){const y=v(!1),{paginationData:p,handleCurrentChange:j,handleSizeChange:Z}=ne(),c=v(!1),x=v(null),V=v(void 0),o=v({}),H=O({path:[{required:!0,trigger:"blur",message:"请输入api路径"}],description:[{required:!0,trigger:"blur",message:"请输入api简介"}],api_group:[{required:!0,trigger:"blur",message:"请输入api分组"}],is_write_log:[{required:!0,trigger:"change",message:"请选择是否记录日志"}],is_need_login:[{required:!0,trigger:"change",message:"请选择是否需要登陆才能访问此接口"}],is_need_permission:[{required:!0,trigger:"change",message:"请选择是否需要权限才能访问此接口"}],method:[{required:!0,trigger:"change",message:"请选择请求方式"}]}),J=()=>{var r;(r=x.value)==null||r.validate((t,g)=>{t?V.value===void 0?ue(o.value).then(()=>{A.success("新增成功"),w()}).finally(()=>{c.value=!1}):se(V.value,{...o.value}).then(()=>{A.success("修改成功"),w()}).finally(()=>{c.value=!1}):console.error("表单校验不通过",g)})},K=()=>{var r;V.value=void 0,(r=x.value)==null||r.resetFields(),o.value={}},Q=r=>{ie.confirm("此操作将永久删除所有角色下该api，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{pe({id:[r.id]}).then(()=>{A.success("删除成功"),w()})})},W=r=>{me(r.id).then(t=>{V.value=r.id,Object.assign(o.value,t.data||{}),c.value=!0})},z=v([]),T=v(null),i=O({path:"",description:"",apiGroup:"",writeLog:void 0,method:""}),$=de("method"),w=()=>{y.value=!0,_e({page:p.currentPage,page_size:p.pageSize,path:i.path||void 0,description:i.description||void 0,api_group:i.apiGroup||void 0,is_write_log:i.writeLog||void 0,method:i.method||void 0}).then(r=>{p.total=r.data.total,z.value=r.data.list}).catch(()=>{z.value=[]}).finally(()=>{y.value=!1})},E=()=>{p.currentPage===1?w():p.currentPage=1},X=()=>{var r;(r=T.value)==null||r.resetFields(),E()};return fe([()=>p.currentPage,()=>p.pageSize],w,{immediate:!0}),(r,t)=>{const g=s("el-input"),u=s("el-form-item"),k=s("el-option"),D=s("el-select"),f=s("el-button"),F=s("el-form"),G=s("el-card"),_=s("el-table-column"),Y=s("el-table"),ee=s("el-pagination"),h=s("el-radio"),P=s("el-radio-group"),le=s("el-dialog"),R=I("loading"),S=I("permission");return m(),q("div",ve,[C((m(),b(G,{shadow:"never",class:"search-wrapper"},{default:a(()=>[e(F,{ref_key:"searchFormRef",ref:T,inline:!0,model:i},{default:a(()=>[e(u,{prop:"path",label:"Api路径"},{default:a(()=>[e(g,{modelValue:i.path,"onUpdate:modelValue":t[0]||(t[0]=l=>i.path=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"description",label:"Api描述"},{default:a(()=>[e(g,{modelValue:i.description,"onUpdate:modelValue":t[1]||(t[1]=l=>i.description=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"apiGroup",label:"Api组"},{default:a(()=>[e(g,{modelValue:i.apiGroup,"onUpdate:modelValue":t[2]||(t[2]=l=>i.apiGroup=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"writeLog",label:"记录日志"},{default:a(()=>[e(D,{modelValue:i.writeLog,"onUpdate:modelValue":t[3]||(t[3]=l=>i.writeLog=l),clearable:"",placeholder:"是否记录日志"},{default:a(()=>[e(k,{key:"true",label:"是",value:"true"}),e(k,{key:"false",label:"否",value:"false"})]),_:1},8,["modelValue"])]),_:1}),e(u,{prop:"method",label:"请求方式"},{default:a(()=>[e(D,{clearable:"",placeholder:"请选择请求方式",modelValue:i.method,"onUpdate:modelValue":t[4]||(t[4]=l=>i.method=l)},{default:a(()=>[(m(!0),q(M,null,N(d($),l=>(m(),b(k,{key:l.value,label:`${l.label}(${l.value})`,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(f,{type:"primary",icon:d(te),onClick:E},{default:a(()=>[n("查询")]),_:1},8,["icon"]),e(f,{icon:d(oe),onClick:X},{default:a(()=>[n("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1})),[[R,y.value]]),C((m(),b(G,{shadow:"never"},{default:a(()=>[U("div",be,[U("div",null,[C((m(),b(f,{type:"primary",icon:d(re),onClick:t[5]||(t[5]=l=>c.value=!0)},{default:a(()=>[n("新增Api")]),_:1},8,["icon"])),[[S,d(L)+"_POST"]])])]),U("div",he,[e(Y,{data:z.value},{default:a(()=>[e(_,{prop:"id",label:"ID","min-width":"110"}),e(_,{prop:"api_group",label:"Api分组","min-width":"110"}),e(_,{prop:"path",label:"Api路径","min-width":"160",sortable:""}),e(_,{prop:"description",label:"Api简介","min-width":"110"}),e(_,{prop:"is_write_log",label:"记录日志","min-width":"110"},{default:a(l=>[n(B(l.row.is_write_log?"是":"否"),1)]),_:1}),e(_,{prop:"is_need_login",label:"需要登陆","min-width":"110"},{default:a(l=>[n(B(l.row.is_need_login?"是":"否"),1)]),_:1}),e(_,{prop:"is_need_permission",label:"需要权限","min-width":"110"},{default:a(l=>[n(B(l.row.is_need_permission?"是":"否"),1)]),_:1}),e(_,{prop:"method",label:"请求","min-width":"110"}),e(_,{label:"操作",width:"150",align:"center"},{default:a(l=>[C((m(),b(f,{type:"primary",text:"",bg:"",size:"small",onClick:ae=>W(l.row)},{default:a(()=>[n("修改")]),_:2},1032,["onClick"])),[[S,d(L)+"/:id_PUT"]]),C((m(),b(f,{type:"danger",text:"",bg:"",size:"small",onClick:ae=>Q(l.row)},{default:a(()=>[n("删除")]),_:2},1032,["onClick"])),[[S,d(L)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),U("div",Ve,[e(ee,{background:"",layout:d(p).layout,"page-sizes":d(p).pageSizes,total:d(p).total,"page-size":d(p).pageSize,currentPage:d(p).currentPage,onSizeChange:d(Z),onCurrentChange:d(j)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[R,y.value]]),e(le,{modelValue:c.value,"onUpdate:modelValue":t[14]||(t[14]=l=>c.value=l),title:V.value===void 0?"新增":"修改",onClose:K,width:"30%"},{footer:a(()=>[e(f,{onClick:t[13]||(t[13]=l=>c.value=!1)},{default:a(()=>[n("取消")]),_:1}),e(f,{type:"primary",onClick:J},{default:a(()=>[n("确认")]),_:1})]),default:a(()=>[e(F,{ref_key:"formRef",ref:x,model:o.value,rules:H,"label-width":"100px","label-position":"right"},{default:a(()=>[e(u,{prop:"path",label:"Api路径"},{default:a(()=>[e(g,{modelValue:o.value.path,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.path=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"method",label:"请求方式"},{default:a(()=>[e(D,{placeholder:"请选择",filterable:"",modelValue:o.value.method,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.method=l)},{default:a(()=>[(m(!0),q(M,null,N(d($),l=>(m(),b(k,{key:l.value,label:`${l.label}(${l.value})`,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{prop:"apiGroup",label:"Api分组"},{default:a(()=>[e(g,{modelValue:o.value.api_group,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.api_group=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"description",label:"Api简介"},{default:a(()=>[e(g,{modelValue:o.value.description,"onUpdate:modelValue":t[9]||(t[9]=l=>o.value.description=l),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(u,{prop:"writeLog",label:"记录日志"},{default:a(()=>[e(P,{modelValue:o.value.is_write_log,"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.is_write_log=l)},{default:a(()=>[e(h,{label:!0},{default:a(()=>[n("是")]),_:1}),e(h,{label:!1},{default:a(()=>[n("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{prop:"needLogin",label:"需要登陆"},{default:a(()=>[e(P,{modelValue:o.value.is_need_login,"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.is_need_login=l)},{default:a(()=>[e(h,{label:!0},{default:a(()=>[n("是")]),_:1}),e(h,{label:!1},{default:a(()=>[n("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{prop:"needPermission",label:"需要权限"},{default:a(()=>[e(P,{modelValue:o.value.is_need_permission,"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.is_need_permission=l)},{default:a(()=>[e(h,{label:!0},{default:a(()=>[n("是")]),_:1}),e(h,{label:!1},{default:a(()=>[n("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Ae=ge(we,[["__scopeId","data-v-a713f1ee"]]);export{Ae as default};
