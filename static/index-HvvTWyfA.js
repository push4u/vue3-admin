import{B as Y,D as ee,E as P,C as ae}from"./element-V6-G1TdP.js";import{u as te}from"./usePagination-rdI7J7GV.js";import{f as le}from"./index-q1rzTrQ-.js";import{a as T,C as oe,U as ne,D as se,G as re,L as ie}from"./index-Xwcysvb7.js";import{S as pe}from"./index-GcAM2lvu.js";import{L as ue,_ as de}from"./index-nlWAN4x3.js";import{l as ce,r as d,Z as R,b as me,e as _e,ag as p,aq as $,m as b,p as fe,V as y,M as w,O as l,u as i,S as c,q as S,T as o,R as B}from"./vue-ZDMaqQfr.js";import"./vxe-SD4sv8pp.js";const ge={class:"app-container"},he={class:"toolbar-wrapper"},ve={class:"table-wrapper"},be={class:"pager-wrapper"},Ce=ce({name:"role",__name:"index",setup(ke){const x=d(!1),{paginationData:u,handleCurrentChange:M,handleSizeChange:N}=te(),m=d(!1),L=d(null),t=R({name:"",groups:[],apis:[]}),q=R({name:[{required:!0,trigger:"blur",message:"请输入名称"}]}),A={label:"description",children:"children"},I=()=>{var n;(n=L.value)==null||n.validate((a,r)=>{a?(t.apis=z.value.getCheckedKeys(!1).filter(e=>typeof e=="number").map(Number),g.value===void 0?oe({name:t.name,group_id:t.groups,api_id:t.apis}).then(()=>{P.success("新增成功"),C()}).finally(()=>{m.value=!1}):ne(g.value,{name:t.name,group_id:t.groups,api_id:t.apis}).then(()=>{P.success("修改成功"),C()}).finally(()=>{m.value=!1})):console.error("表单校验不通过",r)})},z=d(),K=()=>{z.value.setCheckedKeys([],!1)},O=()=>{g.value=void 0,t.apis=[],t.groups=[],t.name="",K()},F=n=>{ae.confirm("此操作将永久删除该角色，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{se({id:[n.id]}).then(()=>{P.success("删除成功"),C()})})},g=d(void 0),H=n=>{re(n.id).then(a=>{var e,_;const r=a.data;if(r.groups!=null&&((e=r.groups)==null?void 0:e.length)>0){const f=[];r.groups.forEach(v=>{f.push(v.id)}),t.groups=f}if(r.apis!=null&&((_=r.apis)==null?void 0:_.length)>0){const f=[];r.apis.forEach(v=>{f.push(v.id)}),t.apis=f}g.value=a.data.id,t.name=a.data.name,m.value=!0})},V=d([]),C=()=>{x.value=!0,ie({page:1,page_size:20}).then(n=>{u.total=n.data.total,V.value=n.data.list}).catch(()=>{V.value=[]}).finally(()=>{x.value=!1})},Z={checkStrictly:!0,emitPath:!1,multiple:!0},U=d([]);(()=>{pe().then(n=>{U.value=n.data})})();const h=d([]);(()=>{ue({page:1,page_size:999}).then(n=>{let a=[];a=n.data.list,[...new Set(a.map(e=>e.api_group))].forEach(e=>{h.value.push({description:e,id:e,children:[]})}),a.forEach(e=>{h.value.forEach(_=>{_.description===e.api_group&&e.is_need_permission&&_.children.push(e)})}),h.value=h.value.filter(e=>e.children.length>0)})})(),me([()=>u.currentPage,()=>u.pageSize],C,{immediate:!0});const G=_e(()=>n=>le(n));return(n,a)=>{const r=p("el-button"),e=p("el-table-column"),_=p("el-table"),f=p("el-pagination"),v=p("el-card"),j=p("el-input"),D=p("el-form-item"),J=p("el-cascader"),Q=p("el-form"),W=p("el-dialog"),E=$("permission"),X=$("loading");return b(),fe("div",ge,[y((b(),w(v,{shadow:"never"},{default:l(()=>[S("div",he,[S("div",null,[y((b(),w(r,{type:"primary",icon:i(Y),onClick:a[0]||(a[0]=s=>m.value=!0)},{default:l(()=>[c("新增角色")]),_:1},8,["icon"])),[[E,i(T)+"_POST"]])])]),S("div",ve,[o(_,{data:V.value},{default:l(()=>[o(e,{prop:"name",label:"角色名称","min-width":"110"}),o(e,{prop:"nickname",label:"创建人","min-width":"110"},{default:l(s=>{var k;return[c(B((k=s.row.user)==null?void 0:k.username),1)]}),_:1}),o(e,{prop:"created_at",label:"创建时间","min-width":"160",sortable:""},{default:l(s=>[c(B(G.value(s.row.created_at)),1)]),_:1}),o(e,{prop:"updated_at",label:"最后更新时间","min-width":"160",sortable:""},{default:l(s=>[c(B(G.value(s.row.updated_at)),1)]),_:1}),o(e,{label:"操作",width:"150"},{default:l(s=>[y((b(),w(r,{type:"primary",text:"",bg:"",size:"small",onClick:k=>H(s.row)},{default:l(()=>[c("修改")]),_:2},1032,["onClick"])),[[E,i(T)+"/:id_PUT"]]),y((b(),w(r,{type:"danger",text:"",bg:"",size:"small",onClick:k=>F(s.row)},{default:l(()=>[c("删除")]),_:2},1032,["onClick"])),[[E,i(T)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),S("div",be,[o(f,{background:"",layout:i(u).layout,"page-sizes":i(u).pageSizes,total:i(u).total,"page-size":i(u).pageSize,currentPage:i(u).currentPage,onSizeChange:i(N),onCurrentChange:i(M)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[X,x.value]]),o(W,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=s=>m.value=s),title:g.value===void 0?"新增":"修改",onClose:O,width:"30%"},{footer:l(()=>[o(r,{onClick:a[3]||(a[3]=s=>m.value=!1)},{default:l(()=>[c("取消")]),_:1}),o(r,{type:"primary",onClick:I},{default:l(()=>[c("确认")]),_:1})]),default:l(()=>[o(Q,{ref_key:"formRef",ref:L,model:t,rules:q,"label-width":"100px","label-position":"right"},{default:l(()=>[o(D,{prop:"name",label:"角色名称"},{default:l(()=>[o(j,{modelValue:t.name,"onUpdate:modelValue":a[1]||(a[1]=s=>t.name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(D,{prop:"groups",label:"数据权限"},{default:l(()=>[o(J,{modelValue:t.groups,"onUpdate:modelValue":a[2]||(a[2]=s=>t.groups=s),options:U.value,props:Z,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),o(D,{prop:"apis",label:"操作权限"},{default:l(()=>[o(i(ee),{ref_key:"treeRef",ref:z,data:h.value,"show-checkbox":"","node-key":"id","highlight-current":"","default-checked-keys":t.apis,props:A},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Be=de(Ce,[["__scopeId","data-v-963d7399"]]);export{Be as default};
