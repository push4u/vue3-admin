import{B as Y,D as ee,E as P,C as ae}from"./element-V6-G1TdP.js";import{u as te}from"./usePagination-rdI7J7GV.js";import{f as le}from"./index-evic_OYw.js";import{a as T,C as oe,U as ne,D as se,G as re,L as ie}from"./index-Uhu9hv9U.js";import{S as pe}from"./index-OH-Q5JHd.js";import{L as ue,_ as de}from"./index-blnq_8Yi.js";import{l as ce,r as d,Z as R,b as me,e as _e,ag as p,aq as $,m as v,p as fe,V as k,M as y,O as l,u as i,S as c,q as w,T as o,R as B}from"./vue-ZDMaqQfr.js";import"./vxe-SD4sv8pp.js";const ge={class:"app-container"},he={class:"toolbar-wrapper"},ve={class:"table-wrapper"},be={class:"pager-wrapper"},Ce=ce({name:"role",__name:"index",setup(ke){const S=d(!1),{paginationData:u,handleCurrentChange:M,handleSizeChange:N}=te(),m=d(!1),L=d(null),a=R({name:"",groups:[],apis:[]}),q=R({name:[{required:!0,trigger:"blur",message:"请输入名称"}]}),A={label:"description",children:"children"},I=()=>{var n;(n=L.value)==null||n.validate((e,r)=>{e?(a.apis=x.value.getCheckedKeys(!1).filter(t=>typeof t=="number").map(Number),g.value===void 0?oe({name:a.name,group_id:a.groups,api_id:a.apis}).then(()=>{P.success("新增成功"),b()}).finally(()=>{m.value=!1}):ne(g.value,{name:a.name,group_id:a.groups,api_id:a.apis}).then(()=>{P.success("修改成功"),b()}).finally(()=>{m.value=!1})):console.error("表单校验不通过",r)})},x=d(),K=()=>{x.value.setCheckedKeys([],!1)},O=()=>{g.value=void 0,a.apis=[],a.groups=[],a.name="",K()},F=n=>{ae.confirm("此操作将永久删除该角色，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{se({id:[n.id]}).then(()=>{P.success("删除成功"),b()})})},g=d(void 0),H=n=>{re(n.id).then(e=>{var t,_;const r=e.data;if(r.groups!=null&&((t=r.groups)==null?void 0:t.length)>0){const f=[];r.groups.forEach(h=>{f.push(h.id)}),a.groups=f}if(r.apis!=null&&((_=r.apis)==null?void 0:_.length)>0){const f=[];r.apis.forEach(h=>{f.push(h.id)}),a.apis=f}g.value=e.data.id,a.name=e.data.name,m.value=!0})},z=d([]),b=()=>{S.value=!0,ie({page:1,page_size:20}).then(n=>{u.total=n.data.total,z.value=n.data.list}).catch(()=>{z.value=[]}).finally(()=>{S.value=!1})},Z={checkStrictly:!0,emitPath:!1,multiple:!0},U=d([]);(()=>{pe().then(n=>{U.value=n.data})})();const V=d([]);(()=>{ue({page:1,page_size:999}).then(n=>{let e=[];e=n.data.list,[...new Set(e.map(t=>t.api_group))].forEach(t=>{V.value.push({description:t,id:t,children:[]})}),e.forEach(t=>{V.value.forEach(_=>{_.description===t.api_group&&_.children.push(t)})})})})(),me([()=>u.currentPage,()=>u.pageSize],b,{immediate:!0});const G=_e(()=>n=>le(n));return(n,e)=>{const r=p("el-button"),t=p("el-table-column"),_=p("el-table"),f=p("el-pagination"),h=p("el-card"),j=p("el-input"),D=p("el-form-item"),J=p("el-cascader"),Q=p("el-form"),W=p("el-dialog"),E=$("permission"),X=$("loading");return v(),fe("div",ge,[k((v(),y(h,{shadow:"never"},{default:l(()=>[w("div",he,[w("div",null,[k((v(),y(r,{type:"primary",icon:i(Y),onClick:e[0]||(e[0]=s=>m.value=!0)},{default:l(()=>[c("新增角色")]),_:1},8,["icon"])),[[E,i(T)+"_POST"]])])]),w("div",ve,[o(_,{data:z.value},{default:l(()=>[o(t,{prop:"name",label:"角色名称","min-width":"110"}),o(t,{prop:"nickname",label:"创建人","min-width":"110"},{default:l(s=>{var C;return[c(B((C=s.row.user)==null?void 0:C.username),1)]}),_:1}),o(t,{prop:"created_at",label:"创建时间","min-width":"160",sortable:""},{default:l(s=>[c(B(G.value(s.row.created_at)),1)]),_:1}),o(t,{prop:"updated_at",label:"最后更新时间","min-width":"160",sortable:""},{default:l(s=>[c(B(G.value(s.row.updated_at)),1)]),_:1}),o(t,{label:"操作",width:"150"},{default:l(s=>[k((v(),y(r,{type:"primary",text:"",bg:"",size:"small",onClick:C=>H(s.row)},{default:l(()=>[c("修改")]),_:2},1032,["onClick"])),[[E,i(T)+"/:id_PUT"]]),k((v(),y(r,{type:"danger",text:"",bg:"",size:"small",onClick:C=>F(s.row)},{default:l(()=>[c("删除")]),_:2},1032,["onClick"])),[[E,i(T)+"_DELETE"]])]),_:1})]),_:1},8,["data"])]),w("div",be,[o(f,{background:"",layout:i(u).layout,"page-sizes":i(u).pageSizes,total:i(u).total,"page-size":i(u).pageSize,currentPage:i(u).currentPage,onSizeChange:i(N),onCurrentChange:i(M)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[X,S.value]]),o(W,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=s=>m.value=s),title:g.value===void 0?"新增":"修改",onClose:O,width:"30%"},{footer:l(()=>[o(r,{onClick:e[3]||(e[3]=s=>m.value=!1)},{default:l(()=>[c("取消")]),_:1}),o(r,{type:"primary",onClick:I},{default:l(()=>[c("确认")]),_:1})]),default:l(()=>[o(Q,{ref_key:"formRef",ref:L,model:a,rules:q,"label-width":"100px","label-position":"right"},{default:l(()=>[o(D,{prop:"name",label:"角色名称"},{default:l(()=>[o(j,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=s=>a.name=s),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(D,{prop:"groups",label:"数据权限"},{default:l(()=>[o(J,{modelValue:a.groups,"onUpdate:modelValue":e[2]||(e[2]=s=>a.groups=s),options:U.value,props:Z,placeholder:"请选择","show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1}),o(D,{prop:"apis",label:"操作权限"},{default:l(()=>[o(i(ee),{ref_key:"treeRef",ref:x,data:V.value,"show-checkbox":"","node-key":"id","highlight-current":"","default-checked-keys":a.apis,props:A},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),Be=de(Ce,[["__scopeId","data-v-ff3deaca"]]);export{Be as default};
